{
  "dataset_id": "utokyo_pr2_opening_fridge_0.1.0",
  "episode_id": "episode_034",
  "task_summary": "PR2 approaches the refrigerator, finds and grasps the handle, pulls to open the hinged door, verifies it is open, retreats, and releases.",
  "task_long_description": {
    "overview": "A PR2 manipulator opens a compact refrigerator located beside a drawer cabinet. The robot must approach the fridge front, perceive the handle, precisely align the end-effector, grasp using a pull strategy, and actuate the hinged door until the interior is visible. The behavior accounts for perception uncertainty by falling back to detection if the handle is not immediately visible, and time-bounds alignment. After opening, the robot verifies door state, retreats to clear the swing, and releases the handle. The sequence emphasizes safe, precise approach in a cluttered workspace.",
    "preconditions": [
      "Fridge is reachable from the current workspace",
      "End-effector is empty and operable",
      "Hinged door opens by pulling from the handle",
      "Scene free of blocking obstacles along pull arc"
    ],
    "stepwise_plan": [
      "Navigate/position to the fridge front if not already there",
      "Perceive the fridge handle (detect if not visible)",
      "Approach and align to grasp pose with tight tolerance",
      "Set wrist yaw and open gripper",
      "Compute grasp pose and grasp the handle",
      "Execute door opening on hinged container",
      "Verify door open state",
      "Retreat to clear door swing and release"
    ],
    "success_criteria": [
      "ContainerOpen(fridge_door) condition is true",
      "Door aperture sufficient to view interior shelves",
      "No collisions with cabinet, fridge, or surrounding objects",
      "Robot retreats to a safe standoff after opening"
    ],
    "failure_and_recovery": [
      "Handle not detected → run target scan/detection again",
      "Misalignment or contact failure → re-approach with same tolerance",
      "Grasp slip → reopen gripper, recompute grasp, retry pick",
      "Door stuck → extend OpenContainer duration or adjust pull arc (not in library)"
    ],
    "termination": "Tree returns SUCCESS once ContainerOpen is true and retreat completes; returns FAILURE if timeouts or grasp/detection fail without recovery."
  },
  "frame_ranking": {
    "order": ["frame_3","frame_5","frame_6","frame_2","frame_4","frame_7","frame_1","frame_0","frame_8"],
    "scores": {
      "frame_0": 0.18,
      "frame_1": 0.32,
      "frame_2": 0.58,
      "frame_3": 0.93,
      "frame_4": 0.66,
      "frame_5": 0.86,
      "frame_6": 0.74,
      "frame_7": 0.52,
      "frame_8": 0.12
    },
    "rationale_per_frame": {
      "frame_3": {
        "now_evidence": "Grasp on handle appears established; alignment and pre-pull posture visible.",
        "predicts_next": "Door actuation by pulling along hinge arc is expected.",
        "uncertainty_reduction": "high"
      }
    }
  },
  "task_instruction": "opening the fridge",
  "instruction_to_ports": {
    "force": null,
    "timeout_ms": null,
    "tolerance": null,
    "retry_attempts": null
  },
  "frame_source": "contact_sheet",
  "frame_order": ["frame_0","frame_1","frame_2","frame_3","frame_4","frame_5","frame_6","frame_7","frame_8"],
  "objects": ["fridge", "fridge_door", "fridge_handle", "cabinet_drawers", "shelves_inside", "PR2_arm"],
  "objects_from_instruction": ["fridge"],
  "blackboard_keys": ["handle_grasp"],
  "node_specs": [
    {"id":"IsAt","type":"Condition","ports":{"target":"fridge_front"},"description":"Checks if the robot is already at the fridge front."},
    {"id":"MoveTo","type":"Action","ports":{"target":"fridge_front","timeout_ms":1500},"description":"Move base/arm to the fridge front pose."},
    {"id":"IsObjectVisible","type":"Condition","ports":{"target":"fridge_handle"},"description":"Confirms handle visibility."},
    {"id":"DetectObject","type":"Action","ports":{"target":"fridge_handle","timeout_ms":800},"description":"Runs perception to find the handle."},
    {"id":"ApproachAndAlign","type":"Action","ports":{"target":"fridge_handle","tolerance":0.005,"timeout_ms":1500},"description":"Approach and align end-effector to handle."},
    {"id":"SetTCPYaw","type":"Action","ports":{"yaw_deg":90},"description":"Orient wrist to match handle grasp orientation."},
    {"id":"OpenGripper","type":"Action","ports":{"width":0.09,"timeout_ms":500},"description":"Open gripper before grasp; repeated to release at end."},
    {"id":"ComputeGraspPose","type":"Action","ports":{"target":"fridge_handle","strategy":"pull","result_key":"handle_grasp"},"description":"Compute grasp pose for pulling strategy and store key."},
    {"id":"Pick","type":"Action","ports":{"grasp_key":"handle_grasp","timeout_ms":1200},"description":"Execute grasp using computed pose."},
    {"id":"OpenContainer","type":"Action","ports":{"target":"fridge_door","container_type":"hinged_door","timeout_ms":2000},"description":"Pulls and opens the hinged fridge door."},
    {"id":"ContainerOpen","type":"Condition","ports":{"target":"fridge_door"},"description":"Verifies the door is open."},
    {"id":"Retreat","type":"Action","ports":{"distance":0.2,"timeout_ms":800},"description":"Back off to a safe distance after opening."}
  ],
  "tree_stats": {"nodes_total": 17, "actions": 10, "conditions": 3, "depth": 3},
  "failure_modes": [
    "Handle not detected or occluded",
    "Approach misalignment causing contact failure",
    "Grasp slip on smooth handle",
    "Door resistance higher than expected"
  ],
  "recovery_strategy": [
    "Fallback to DetectObject if visibility check fails",
    "Timeout-guarded re-approach to the handle",
    "Reopen gripper and recompute grasp, then Pick again",
    "Repeat OpenContainer if door initially resists"
  ],
  "assumptions": [
    "Door is a hinged door that opens by pulling left-to-right as suggested by frames.",
    "Handle grasp is feasible with a bar-like geometry; exact handle type not specified.",
    "Yaw 90° aligns gripper with handle axis; acceptable within task tolerance."
  ],
  "evaluation_notes": {
    "expected_success_criteria": [
      "ContainerOpen condition becomes true",
      "Camera view reveals interior shelves",
      "No collisions during pull arc",
      "Robot retreats and releases handle"
    ],
    "test_scenarios": ["happy path","object_missing","grasp_fail","perception_noise"]
  },
  "timing": {"model_reported_tokens": null, "client_elapsed_ms": null},
  "local_annotations": [
    {
      "frame": "frame_0",
      "phase": "perceive",
      "active_leaf": {"id":"IsObjectVisible","attrs":{"target":"fridge_handle"}},
      "active_path_ids": []
    },
    {
      "frame": "frame_1",
      "phase": "perceive",
      "active_leaf": {"id":"DetectObject","attrs":{"target":"fridge_handle","timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_2",
      "phase": "approach",
      "active_leaf": {"id":"ApproachAndAlign","attrs":{"target":"fridge_handle","tolerance":0.005,"timeout_ms":1500}},
      "active_path_ids": []
    },
    {
      "frame": "frame_3",
      "phase": "grasp",
      "active_leaf": {"id":"Pick","attrs":{"grasp_key":"handle_grasp","timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_4",
      "phase": "transfer",
      "active_leaf": {"id":"OpenContainer","attrs":{"target":"fridge_door","container_type":"hinged_door","timeout_ms":2000}},
      "active_path_ids": []
    },
    {
      "frame": "frame_5",
      "phase": "transfer",
      "active_leaf": {"id":"OpenContainer","attrs":{"target":"fridge_door","container_type":"hinged_door","timeout_ms":2000}},
      "active_path_ids": []
    },
    {
      "frame": "frame_6",
      "phase": "verify",
      "active_leaf": {"id":"ContainerOpen","attrs":{"target":"fridge_door"}},
      "active_path_ids": []
    },
    {
      "frame": "frame_7",
      "phase": "verify",
      "active_leaf": {"id":"ContainerOpen","attrs":{"target":"fridge_door"}},
      "active_path_ids": []
    },
    {
      "frame": "frame_8",
      "phase": "retreat",
      "active_leaf": {"id":"Retreat","attrs":{"distance":0.2,"timeout_ms":800}},
      "active_path_ids": []
    }
  ]
}
