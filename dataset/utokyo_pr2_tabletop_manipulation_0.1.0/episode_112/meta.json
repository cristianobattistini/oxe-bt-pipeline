{
  "dataset_id": "utokyo_pr2_tabletop_manipulation_0.1.0",
  "episode_id": "episode_112",
  "task_summary": "Detect the grape bunch, approach, compute a pinch grasp, pick it, and lift/retreat to confirm the grape is in the gripper.",
  "task_long_description": {
    "overview": "A PR2-style gripper operates on a tabletop with a white plate and a small grape bunch. The goal is to pick a grape bunch from the table. The robot first verifies visibility, scans if needed, approaches from above, computes a pinch grasp, aligns with tight tolerance, adjusts yaw, grasps, and retreats upward to show a lifted object. The sequence emphasizes reliable perception and gentle manipulation suitable for delicate fruit, with retries on grasping and time-bounded motions.",
    "preconditions": ["Robot calibrated and homed", "Gripper empty and open", "Table workspace known", "Grape bunch present within reachable area", "Collision map loaded for table and plate"],
    "stepwise_plan": ["Open gripper", "Check visibility; if not visible, scan then detect", "Move above grape with safe offset", "Compute grasp pose (pinch) and verify it exists", "Approach and align with tight tolerance", "Set yaw for proper approach", "Execute pick with limited-time attempt; retry if needed", "Verify grasp stability", "Retreat upward", "Confirm object in gripper"],
    "success_criteria": ["ObjectInGripper(grape) is true", "IsGraspStable is true after lift", "End-effector has retreated by at least 0.1 m from the table surface"],
    "failure_and_recovery": ["Perception failure → raster scan then re-detect", "Pick failure → retry grasp up to two attempts", "Slip detected → re-approach and repeat pick (outside this tree scope)", "Timeouts on motions → abort and replan"],
    "termination": "Terminate when the robot has retreated with a stable grasp and ObjectInGripper(grape) is true."
  },
  "frame_ranking": {
    "order": ["frame_3","frame_5","frame_2","frame_6","frame_1","frame_4","frame_7","frame_0","frame_8"],
    "scores": {
      "frame_0": 0.12, "frame_1": 0.34, "frame_2": 0.56, "frame_3": 0.92,
      "frame_4": 0.28, "frame_5": 0.80, "frame_6": 0.49, "frame_7": 0.18, "frame_8": 0.05
    },
    "rationale_per_frame": {
      "frame_3": {
        "now_evidence": "first stable contact and alignment cue visible",
        "predicts_next": "push actuation expected; confirms goal direction",
        "uncertainty_reduction": "high"
      }
    }
  },
  "task_instruction": "picking a grape",
  "instruction_to_ports": {
    "force": null,
    "timeout_ms": null,
    "tolerance": null,
    "retry_attempts": null
  },
  "frame_source": "contact_sheet",
  "frame_order": ["frame_0","frame_1","frame_2","frame_3","frame_4","frame_5","frame_6","frame_7","frame_8"],
  "objects": ["grape", "plate", "table", "pr2_gripper"],
  "objects_from_instruction": ["grape"],
  "blackboard_keys": ["grasp_grape"],
  "node_specs": [
    {"id":"OpenGripper","type":"Action","ports":{"width":"0.09","timeout_ms":"800"},"description":"Open gripper to max width before approach."},
    {"id":"IsObjectVisible","type":"Condition","ports":{"target":"grape"},"description":"Checks if the grape is visible."},
    {"id":"ScanForTarget","type":"Action","ports":{"target":"grape","pattern":"raster","max_attempts":"3","timeout_ms":"1200"},"description":"Raster scan to locate grape if not visible."},
    {"id":"DetectObject","type":"Action","ports":{"target":"grape","timeout_ms":"800"},"description":"Run detection once the area is scanned."},
    {"id":"MoveAbove","type":"Action","ports":{"target":"grape","offset_z":"0.06","timeout_ms":"1200"},"description":"Move to a pregrasp height above the grape."},
    {"id":"ComputeGraspPose","type":"Action","ports":{"target":"grape","strategy":"pinch","result_key":"grasp_grape"},"description":"Compute grasp pose and store to blackboard."},
    {"id":"PoseAvailable","type":"Condition","ports":{"key":"grasp_grape"},"description":"Verify the computed grasp is available."},
    {"id":"ApproachAndAlign","type":"Action","ports":{"target":"grape","tolerance":"0.005","timeout_ms":"1200"},"description":"Precision approach with tight tolerance."},
    {"id":"SetTCPYaw","type":"Action","ports":{"yaw_deg":"90"},"description":"Rotate tool yaw for the grasp."},
    {"id":"Pick","type":"Action","ports":{"grasp_key":"grasp_grape","timeout_ms":"1500"},"description":"Execute grasp using stored pose."},
    {"id":"IsGraspStable","type":"Condition","ports":{},"description":"Confirm the grasp is stable after closing."},
    {"id":"Retreat","type":"Action","ports":{"distance":"0.1","timeout_ms":"800"},"description":"Lift/retreat to clear the workspace."},
    {"id":"ObjectInGripper","type":"Condition","ports":{"target":"grape"},"description":"Final confirmation that grape is held."}
  ],
  "tree_stats": {"nodes_total": 17, "actions": 9, "conditions": 4, "depth": 4},
  "failure_modes": ["Grape not detected", "Collision with plate while approaching", "Insufficient grip causing slip", "Timeout during motion planning"],
  "recovery_strategy": ["Raster scan and re-detect", "Adjust yaw/height and re-approach", "Retry pick with new pose", "Abort and wait for operator if repeated timeouts"],
  "assumptions": ["'Grape' refers to the visible grape bunch in frames", "Task ends after lift/retreat, not after placing", "Gentle force is implied by object fragility though not stated in the instruction", "Yaw rotation about other axes is unnecessary; SetTCPYaw suffices"],
  "evaluation_notes": {
    "expected_success_criteria": ["Stable grasp and lift by 0.1 m", "No contact with plate during retreat", "ObjectInGripper true for grape"],
    "test_scenarios": ["happy path","object_missing","grasp_fail","perception_noise"]
  },
  "timing": {"model_reported_tokens": null, "client_elapsed_ms": null},
  "local_annotations": [
    {
      "frame": "frame_0",
      "phase": "perceive",
      "active_leaf": {"id":"DetectObject","attrs":{"target":"grape","timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_1",
      "phase": "approach",
      "active_leaf": {"id":"MoveAbove","attrs":{"target":"grape","offset_z":0.06,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_2",
      "phase": "approach",
      "active_leaf": {"id":"ApproachAndAlign","attrs":{"target":"grape","tolerance":0.005,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_3",
      "phase": "verify",
      "active_leaf": {"id":"PoseAvailable","attrs":{"key":"grasp_grape"}},
      "active_path_ids": []
    },
    {
      "frame": "frame_4",
      "phase": "grasp",
      "active_leaf": {"id":"Pick","attrs":{"grasp_key":"grasp_grape","timeout_ms":1500}},
      "active_path_ids": []
    },
    {
      "frame": "frame_5",
      "phase": "grasp",
      "active_leaf": {"id":"IsGraspStable","attrs":{}},
      "active_path_ids": []
    },
    {
      "frame": "frame_6",
      "phase": "transfer",
      "active_leaf": {"id":"Retreat","attrs":{"distance":0.1,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_7",
      "phase": "transfer",
      "active_leaf": {"id":"ObjectInGripper","attrs":{"target":"grape"}},
      "active_path_ids": []
    },
    {
      "frame": "frame_8",
      "phase": "retreat",
      "active_leaf": {"id":"Retreat","attrs":{"distance":0.1,"timeout_ms":800}},
      "active_path_ids": []
    }
  ]
}
