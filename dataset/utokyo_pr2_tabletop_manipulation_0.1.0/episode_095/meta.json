{
  "dataset_id": "utokyo_pr2_tabletop_manipulation_0.1.0",
  "episode_id": "episode_095",
  "task_summary": "Detect the cloth, approach and align, contact the edge, and push to fold it over once, then retreat.",
  "task_long_description": {
    "overview": "A PR2-style manipulator folds a pink cloth lying on a wooden tabletop. The arm approaches from the right, aligns to the cloth’s long edge, makes gentle contact, and uses the gripper as a pusher to crease and fold the cloth onto itself. The plan emphasizes reliable perception, precise alignment, controlled contact, and a directional push along a diagonal toward the table center. Timeouts and retries are conservative to handle cloth deformation and friction variability. The sequence ends with a short retreat and brief wait to allow the cloth to settle.",
    "preconditions": ["Table is clear around the cloth", "Cloth is visible to the camera", "Robot workspace is calibrated", "Gripper operational and zeroed"],
    "stepwise_plan": [
      "Retry visual detection of the cloth.",
      "Move above the cloth at safe height.",
      "Approach and align gripper to the cloth edge with tight tolerance.",
      "Set tool yaw perpendicular to the fold direction.",
      "Open gripper and make gentle contact with the edge.",
      "Push diagonally to initiate the fold and crease.",
      "Make a second shorter push to finish the fold.",
      "Retreat up and away and briefly wait."
    ],
    "success_criteria": ["Cloth shows a clear single fold with overlapping layers", "No slippage out of workspace", "Robot retreats without snagging the cloth"],
    "failure_and_recovery": [
      "Detection failure → retry detection.",
      "Misalignment → re-approach and realign.",
      "Insufficient fold due to friction → perform second push.",
      "Unexpected contact force → abort push and retreat."
    ],
    "termination": "Terminate after retreat and brief wait once a single fold is produced."
  },
  "frame_ranking": {
    "order": ["frame_3","frame_5","frame_2","frame_6","frame_1","frame_4","frame_7","frame_0","frame_8"],
    "scores": {
      "frame_0": 0.12,
      "frame_1": 0.34,
      "frame_2": 0.56,
      "frame_3": 0.92,
      "frame_4": 0.28,
      "frame_5": 0.80,
      "frame_6": 0.49,
      "frame_7": 0.18,
      "frame_8": 0.05
    },
    "rationale_per_frame": {
      "frame_3": {
        "now_evidence": "Gripper orientation and proximity to the cloth edge indicate alignment is complete.",
        "predicts_next": "Push actuation is likely next to initiate the fold.",
        "uncertainty_reduction": "high"
      }
    }
  },
  "task_instruction": "folding a cloth",
  "instruction_to_ports": {
    "force": null,
    "timeout_ms": 1200,
    "tolerance": 0.005,
    "retry_attempts": 3
  },
  "frame_source": "contact_sheet",
  "frame_order": ["frame_0","frame_1","frame_2","frame_3","frame_4","frame_5","frame_6","frame_7","frame_8"],
  "objects": ["pink_cloth", "cloth_edge", "table", "robot_gripper"],
  "objects_from_instruction": ["cloth"],
  "blackboard_keys": [],
  "node_specs": [
    {"id":"DetectObject","type":"Action","ports":{"target":"cloth","timeout_ms":1200},"description":"Detect the cloth using onboard perception with retry."},
    {"id":"MoveAbove","type":"Action","ports":{"target":"cloth","offset_z":0.05,"timeout_ms":1200},"description":"Move to a pregrasp height above the cloth."},
    {"id":"ApproachAndAlign","type":"Action","ports":{"target":"cloth","tolerance":0.005,"timeout_ms":1200},"description":"Approach and align to the cloth edge precisely."},
    {"id":"SetTCPYaw","type":"Action","ports":{"yaw_deg":90},"description":"Rotate tool to be perpendicular to fold direction."},
    {"id":"OpenGripper","type":"Action","ports":{"width":0.09,"timeout_ms":400},"description":"Open gripper to act as a flat pusher."},
    {"id":"LowerUntilContact","type":"Action","ports":{"speed":"slow","max_depth":0.02,"force_threshold":10,"timeout_ms":800},"description":"Lower to make gentle edge contact."},
    {"id":"Push","type":"Action","ports":{"target":"cloth_edge","distance":0.1,"direction_deg":225,"timeout_ms":1500},"description":"Primary diagonal push to crease and start fold."},
    {"id":"Push","type":"Action","ports":{"target":"cloth_edge","distance":0.05,"direction_deg":225,"timeout_ms":1500},"description":"Short finishing push to complete fold."},
    {"id":"Retreat","type":"Action","ports":{"distance":0.1,"timeout_ms":800},"description":"Retreat from the folded cloth."},
    {"id":"Wait","type":"Action","ports":{"timeout_ms":400},"description":"Brief settle time."}
  ],
  "tree_stats": {"nodes_total": 12, "actions": 10, "conditions": 0, "depth": 3},
  "failure_modes": [
    "Cloth not detected due to lighting or pose",
    "Misalignment causing slide instead of fold",
    "Insufficient pushing distance leading to partial fold",
    "Over-contact causing cloth to bunch"
  ],
  "recovery_strategy": [
    "Retry detection up to 3 times",
    "Re-approach with tighter alignment tolerance",
    "Issue a second finishing push",
    "Abort and retreat if excessive force inferred"
  ],
  "assumptions": [
    "Frames show push-fold rather than pick-lift; tree favors pushing.",
    "Direction 225° (down-left) chosen from arm approach and cloth orientation.",
    "Single fold is expected; no multi-step stacking."
  ],
  "evaluation_notes": {
    "expected_success_criteria": ["Single visible fold with overlap and crease", "Arm ends clear of cloth", "No objects displaced from workspace"],
    "test_scenarios": ["happy path","object_missing","grasp_fail","perception_noise"]
  },
  "timing": {"model_reported_tokens": null, "client_elapsed_ms": null},
  "local_annotations": [
    {
      "frame": "frame_0",
      "phase": "perceive",
      "active_leaf": {"id":"DetectObject","attrs":{"target":"cloth","timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_1",
      "phase": "approach",
      "active_leaf": {"id":"MoveAbove","attrs":{"target":"cloth","offset_z":0.05,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_2",
      "phase": "verify",
      "active_leaf": {"id":"ApproachAndAlign","attrs":{"target":"cloth","tolerance":0.005,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_3",
      "phase": "verify",
      "active_leaf": {"id":"SetTCPYaw","attrs":{"yaw_deg":90}},
      "active_path_ids": []
    },
    {
      "frame": "frame_4",
      "phase": "place",
      "active_leaf": {"id":"LowerUntilContact","attrs":{"speed":"slow","max_depth":0.02,"force_threshold":10,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_5",
      "phase": "transfer",
      "active_leaf": {"id":"Push","attrs":{"target":"cloth_edge","distance":0.1,"direction_deg":225,"timeout_ms":1500}},
      "active_path_ids": []
    },
    {
      "frame": "frame_6",
      "phase": "transfer",
      "active_leaf": {"id":"Push","attrs":{"target":"cloth_edge","distance":0.05,"direction_deg":225,"timeout_ms":1500}},
      "active_path_ids": []
    },
    {
      "frame": "frame_7",
      "phase": "retreat",
      "active_leaf": {"id":"Retreat","attrs":{"distance":0.1,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_8",
      "phase": "retreat",
      "active_leaf": {"id":"Wait","attrs":{"timeout_ms":400}},
      "active_path_ids": []
    }
  ]
}
