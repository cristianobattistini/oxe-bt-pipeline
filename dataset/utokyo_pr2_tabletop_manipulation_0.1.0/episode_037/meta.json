{
  "dataset_id": "utokyo_pr2_tabletop_manipulation_0.1.0",
  "episode_id": "episode_037",
  "task_summary": "Perceive a pink cloth, approach its edge, orient the tool, and fold it by pushing the edge twice before retreating.",
  "task_long_description": {
    "overview": "A PR2-like manipulator folds a small pink cloth lying on a wooden tabletop. The robot first ensures the cloth is detected, computes a push-based pose along a visible edge, then approaches and aligns. It orients the end-effector, opens the gripper to use it as a flat pusher, and performs two push strokes to create a fold. After finishing the push sequence, it retreats and pauses briefly. The plan emphasizes gentle contact and alignment rather than grasping.",
    "preconditions": ["Workspace is clear around the cloth", "Cloth is visible to the camera", "Robot arm is free and gripper operational", "Pushing is acceptable for folding"],
    "stepwise_plan": [
      "Verify/locate cloth; scan if needed.",
      "Compute a push pose along the cloth edge.",
      "Move to pre-push pose and align precisely.",
      "Orient wrist to 90° and open gripper.",
      "Perform two push strokes to fold the cloth.",
      "Retreat from the cloth and wait briefly."
    ],
    "success_criteria": ["Cloth area appears halved and thicker (visibly folded)", "No object displacement outside safe zone", "Robot returns to a safe, non-contact pose"],
    "failure_and_recovery": [
      "Perception failure: run raster scan and re-detect.",
      "Misalignment before push: repeat alignment.",
      "Insufficient fold after first push: second push pass addresses it."
    ],
    "termination": "Stop after completing the push repeats, retreating, and waiting."
  },
  "frame_ranking": {
    "order": ["frame_3","frame_5","frame_2","frame_6","frame_1","frame_4","frame_7","frame_0", "frame_8"],
    "scores": {
      "frame_0": 0.12, "frame_1": 0.34, "frame_2": 0.56, "frame_3": 0.92,
      "frame_4": 0.28, "frame_5": 0.80, "frame_6": 0.49, "frame_7": 0.18, "frame_8": 0.05
    },
    "rationale_per_frame": {
      "frame_3": {
        "now_evidence": "End-effector aligned close to the cloth edge, poised for contact.",
        "predicts_next": "Initiation of a push motion to start the fold.",
        "uncertainty_reduction": "high"
      }
    }
  },
  "task_instruction": "folding a cloth",
  "instruction_to_ports": {
    "force": 10,
    "timeout_ms": 1200,
    "tolerance": 0.005,
    "retry_attempts": null
  },
  "frame_source": "contact_sheet",
  "frame_order": ["frame_0","frame_1","frame_2","frame_3","frame_4","frame_5","frame_6","frame_7", "frame_8"],
  "objects": ["cloth", "cloth_edge", "table", "gripper"],
  "objects_from_instruction": ["cloth"],
  "blackboard_keys": ["push_pose"],
  "node_specs": [
    {"id":"IsObjectVisible","type":"Condition","ports":{"target":"cloth"},"description":"Checks if the cloth is currently visible."},
    {"id":"ScanForTarget","type":"Action","ports":{"target":"cloth","pattern":"raster","max_attempts":3,"timeout_ms":1200},"description":"Raster scan to localize the cloth if not visible."},
    {"id":"DetectObject","type":"Action","ports":{"target":"cloth","timeout_ms":1500},"description":"Run detector to obtain a confident cloth observation."},
    {"id":"ComputeGraspPose","type":"Action","ports":{"target":"cloth_edge","strategy":"push","result_key":"push_pose"},"description":"Compute a push pose along the cloth edge and store to blackboard."},
    {"id":"MoveTo","type":"Action","ports":{"target":"push_pose","timeout_ms":1500},"description":"Go to the computed pre-push pose."},
    {"id":"ApproachAndAlign","type":"Action","ports":{"target":"cloth_edge","tolerance":0.005,"timeout_ms":1200},"description":"Fine approach and alignment near the cloth edge."},
    {"id":"SetTCPYaw","type":"Action","ports":{"yaw_deg":90},"description":"Rotate TCP yaw to be perpendicular to fold line."},
    {"id":"OpenGripper","type":"Action","ports":{"width":0.09,"timeout_ms":400},"description":"Open gripper to act as a flat pusher."},
    {"id":"Push","type":"Action","ports":{"target":"cloth_edge","distance":0.1,"direction_deg":180,"timeout_ms":800},"description":"Push along the fold direction to create the fold."},
    {"id":"Retreat","type":"Action","ports":{"distance":0.1,"timeout_ms":800},"description":"Back off to a safe distance after pushing."},
    {"id":"Wait","type":"Action","ports":{"timeout_ms":400},"description":"Brief pause to settle the scene."}
  ],
  "tree_stats": {"nodes_total": 14, "actions": 10, "conditions": 1, "depth": 3},
  "failure_modes": ["Target not detected", "Pose computation invalid", "Alignment drift during push", "Push distance insufficient"],
  "recovery_strategy": ["Fallback to scan then re-detect", "Recompute push pose", "Re-run ApproachAndAlign", "Use second push cycle via Repeat"],
  "assumptions": ["Frames show push-based folding rather than grasping; thus tree uses Push instead of Pick/Place", "Push direction set to 180° (leftward) inferred from arm approach; exact direction may vary."],
  "evaluation_notes": {
    "expected_success_criteria": ["Visible fold with reduced footprint", "Arm not in contact at end state"],
    "test_scenarios": ["happy path","object_missing","grasp_fail","perception_noise"]
  },
  "timing": {"model_reported_tokens": null, "client_elapsed_ms": null},
  "local_annotations": [
    {
      "frame": "frame_0",
      "phase": "perceive",
      "active_leaf": {"id":"DetectObject","attrs":{"target":"cloth","timeout_ms":1500}},
      "active_path_ids": []
    },
    {
      "frame": "frame_1",
      "phase": "approach",
      "active_leaf": {"id":"MoveTo","attrs":{"target":"push_pose","timeout_ms":1500}},
      "active_path_ids": []
    },
    {
      "frame": "frame_2",
      "phase": "approach",
      "active_leaf": {"id":"ApproachAndAlign","attrs":{"target":"cloth_edge","tolerance":0.005,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_3",
      "phase": "verify",
      "active_leaf": {"id":"IsObjectVisible","attrs":{"target":"cloth"}},
      "active_path_ids": []
    },
    {
      "frame": "frame_4",
      "phase": "transfer",
      "active_leaf": {"id":"Push","attrs":{"target":"cloth_edge","distance":0.1,"direction_deg":180,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_5",
      "phase": "transfer",
      "active_leaf": {"id":"Push","attrs":{"target":"cloth_edge","distance":0.1,"direction_deg":180,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_6",
      "phase": "transfer",
      "active_leaf": {"id":"Push","attrs":{"target":"cloth_edge","distance":0.1,"direction_deg":180,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_7",
      "phase": "retreat",
      "active_leaf": {"id":"Retreat","attrs":{"distance":0.1,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_8",
      "phase": "retreat",
      "active_leaf": {"id":"Wait","attrs":{"timeout_ms":400}},
      "active_path_ids": []
    }
  ]
}

