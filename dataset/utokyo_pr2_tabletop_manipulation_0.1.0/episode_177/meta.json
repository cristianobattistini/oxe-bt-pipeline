{
  "dataset_id": "utokyo_pr2_tabletop_manipulation_0.1.0",
  "episode_id": "episode_177",
  "task_summary": "Detect a grape cluster, grasp a single grape with a pinch strategy, and place it on the plate, then retreat.",
  "task_long_description": {
    "overview": "A PR2 arm operates over a tabletop with a plate and a small grape cluster. The sequence begins with perception and target search, followed by computing a precise pinch grasp for a grape. The arm approaches from above, lowers until contact, and closes the gripper to secure the grape. After verifying stability, it lifts, transfers above the plate, performs a gentle place, opens the gripper to release, and retreats. The contact‑sheet frames show approach from the right, alignment over the plate, and the grape ending up on the plate, indicating a pick‑and‑place of one grape from the cluster.",
    "preconditions": [
      "Workspace is clear and plate is reachable",
      "Gripper is empty and operational",
      "Grape cluster is on the tabletop and visible to the camera or can be found by scanning"
    ],
    "stepwise_plan": [
      "Open gripper and search/verify visibility of the grape",
      "Detect the grape and compute a pinch grasp pose",
      "Move above the grape, align precisely, and descend until contact",
      "Close gripper to grasp and verify grasp stability",
      "Retreat upward and transfer to the plate area",
      "Place at the plate center, open gripper to release, and retreat"
    ],
    "success_criteria": [
      "A grape is securely grasped after closing the gripper",
      "The grape is released onto the plate surface without dropping elsewhere",
      "Robot ends in a safe, retreated pose above the workspace"
    ],
    "failure_and_recovery": [
      "If grape not visible: execute scan with retries",
      "If grasp fails or unstable: recompute grasp and retry approach",
      "If placement fails: reattempt place and adjust yaw if needed"
    ],
    "termination": "Terminate after successful release on the plate and final retreat, or after configured retries are exhausted."
  },
  "frame_ranking": {
    "order": ["frame_3","frame_5","frame_2","frame_6","frame_1","frame_4","frame_7","frame_0","frame_8"],
    "scores": {
      "frame_0": 0.12,
      "frame_1": 0.34,
      "frame_2": 0.56,
      "frame_3": 0.92,
      "frame_4": 0.28,
      "frame_5": 0.80,
      "frame_6": 0.49,
      "frame_7": 0.18,
      "frame_8": 0.05
    },
    "rationale_per_frame": {
      "frame_3": {
        "now_evidence": "first stable contact and alignment cue visible",
        "predicts_next": "push actuation expected; confirms goal direction",
        "uncertainty_reduction": "high"
      }
    }
  },
  "task_instruction": "picking a grape",
  "instruction_to_ports": {
    "force": null,
    "timeout_ms": null,
    "tolerance": null,
    "retry_attempts": null
  },
  "frame_source": "contact_sheet",
  "frame_order": ["frame_0","frame_1","frame_2","frame_3","frame_4","frame_5","frame_6","frame_7","frame_8"],
  "objects": ["grape_cluster","grape","plate","tabletop","robot_arm","gripper"],
  "objects_from_instruction": ["grape"],
  "blackboard_keys": ["grasp_grape","plate_center"],
  "node_specs": [
    {"id":"OpenGripper","type":"Action","ports":{"width":"0.08","timeout_ms":"500"},"description":"Prepare gripper for approach by opening to nominal width."},
    {"id":"IsObjectVisible","type":"Condition","ports":{"target":"grape"},"description":"Check if the grape is currently visible."},
    {"id":"ScanForTarget","type":"Action","ports":{"target":"grape","pattern":"raster","max_attempts":"3","timeout_ms":"1200"},"description":"Active scan to find grape if not visible."},
    {"id":"DetectObject","type":"Action","ports":{"target":"grape","timeout_ms":"800"},"description":"Detect and localize the grape."},
    {"id":"ComputeGraspPose","type":"Action","ports":{"target":"grape","strategy":"pinch","result_key":"grasp_grape"},"description":"Compute pinch grasp pose for a single grape."},
    {"id":"MoveAbove","type":"Action","ports":{"target":"grape","offset_z":"0.05","timeout_ms":"1200"},"description":"Move to a pregrasp position above the grape."},
    {"id":"ApproachAndAlign","type":"Action","ports":{"target":"grape","tolerance":"0.005","timeout_ms":"1200"},"description":"Refine alignment before descent."},
    {"id":"LowerUntilContact","type":"Action","ports":{"speed":"slow","max_depth":"0.05","force_threshold":"10","timeout_ms":"800"},"description":"Descend until gentle contact is detected."},
    {"id":"CloseGripper","type":"Action","ports":{"force":"10","timeout_ms":"800"},"description":"Close gripper to grasp the grape."},
    {"id":"IsGraspStable","type":"Condition","ports":{},"description":"Verify the grasp does not slip."},
    {"id":"Retreat","type":"Action","ports":{"distance":"0.1","timeout_ms":"800"},"description":"Lift away from the table after grasp."},
    {"id":"MoveAbove","type":"Action","ports":{"target":"plate","offset_z":"0.08","timeout_ms":"1200"},"description":"Move to a position above the plate."},
    {"id":"PlaceAt","type":"Action","ports":{"pose_key":"plate_center","yaw_deg":"0","press_force":"10","timeout_ms":"1200"},"description":"Place the grape at the plate center."},
    {"id":"OpenGripper","type":"Action","ports":{"width":"0.06","timeout_ms":"500"},"description":"Release the grape onto the plate."},
    {"id":"Retreat","type":"Action","ports":{"distance":"0.1","timeout_ms":"800"},"description":"Retreat to a safe pose after placing."}
  ],
  "tree_stats": {"nodes_total": 18, "actions": 13, "conditions": 2, "depth": 4},
  "failure_modes": [
    "Grape not detected or occluded by gripper",
    "Pinch grasp slips due to smooth surface",
    "Collision with plate rim during placement",
    "Premature release while transferring"
  ],
  "recovery_strategy": [
    "Fallback to scanning with retries when visibility fails",
    "Recompute grasp pose and reattempt with the same sequence",
    "Lift slightly and re-approach the plate if contact detected during place",
    "If object lost, return to perception phase and restart"
  ],
  "assumptions": [
    "Frames depict pick-and-place of a grape(s) to the plate; instruction says only picking, so placing is added to match visual evidence",
    "Pinch strategy is appropriate for a single grape from a small cluster",
    "plate_center pose is available in the blackboard from perception or prior calibration"
  ],
  "evaluation_notes": {
    "expected_success_criteria": [
      "Grape leaves the cluster attached to the gripper",
      "Grape ends on the plate and remains there after release",
      "Robot retreats without collisions"
    ],
    "test_scenarios": ["happy path","object_missing","grasp_fail","perception_noise"]
  },
  "timing": {"model_reported_tokens": null, "client_elapsed_ms": null},
  "local_annotations": [
    {
      "frame": "frame_0",
      "phase": "perceive",
      "active_leaf": {"id":"ScanForTarget","attrs":{"target":"grape","pattern":"raster","max_attempts":3,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_1",
      "phase": "perceive",
      "active_leaf": {"id":"DetectObject","attrs":{"target":"grape","timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_2",
      "phase": "approach",
      "active_leaf": {"id":"MoveAbove","attrs":{"target":"grape","offset_z":0.05,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_3",
      "phase": "verify",
      "active_leaf": {"id":"ApproachAndAlign","attrs":{"target":"grape","tolerance":0.005,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_4",
      "phase": "grasp",
      "active_leaf": {"id":"LowerUntilContact","attrs":{"speed":"slow","max_depth":0.05,"force_threshold":10,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_5",
      "phase": "grasp",
      "active_leaf": {"id":"CloseGripper","attrs":{"force":10,"timeout_ms":800}},
      "active_path_ids": []
    },
    {
      "frame": "frame_6",
      "phase": "transfer",
      "active_leaf": {"id":"MoveAbove","attrs":{"target":"plate","offset_z":0.08,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_7",
      "phase": "place",
      "active_leaf": {"id":"PlaceAt","attrs":{"pose_key":"plate_center","yaw_deg":0,"press_force":10,"timeout_ms":1200}},
      "active_path_ids": []
    },
    {
      "frame": "frame_8",
      "phase": "retreat",
      "active_leaf": {"id":"Retreat","attrs":{"distance":0.1,"timeout_ms":800}},
      "active_path_ids": []
    }
  ]
}
